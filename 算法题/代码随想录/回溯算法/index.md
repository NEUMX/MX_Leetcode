# 回溯算法

回溯算法（Backtracking）是一种典型的算法设计技术，广泛应用于求解组合问题、排列问题、子集问题等。其核心思想是通过构建候选解的方式逐步尝试，并在某个时刻发现当前路径不满足条件时回溯，撤销上一步的选择，尝试其他可能的路径。

### 回溯算法的基本思想：
回溯算法是暴力搜索（穷举法）的改进版本，它通过树形结构来探索所有可能的解空间，同时采用剪枝技术，避免无效的搜索，从而降低时间复杂度。回溯法通过递归的方式实现，一般来说，回溯算法包括以下几个基本步骤：

1. **选择**：在当前的状态下，从候选列表中选择一个元素。
2. **约束**：判断当前选择是否满足问题的约束条件。
3. **递归**：如果选择满足约束条件，则继续深入选择，进行下一步的搜索。
4. **回溯**：当无法满足约束条件时，撤销选择，返回上一层进行其他可能选择的尝试。

### 回溯算法的应用场景：
+ **排列问题**：如给定一组数字，求其所有排列。
+ **组合问题**：如从给定的数字中选出一些数，求其所有组合。
+ **子集问题**：如给定一个集合，求其所有子集。
+ **图的着色问题**：如用最少的颜色给图中的节点着色。
+ **N皇后问题**：在N×N的棋盘上放置N个皇后，使得它们互不攻击。

### 回溯的典型步骤：
1. **定义状态空间树**：回溯法本质上是在遍历一个树形结构，其中树的每个节点表示一个决策状态。
2. **递归函数**：回溯的递归函数通常包括选择和回溯的操作，通常还会用到一个额外的“剪枝”条件来避免不必要的计算。

### 回溯算法的结构：
回溯算法的结构一般是一个递归函数，基于当前的状态做出一个选择，然后进入下一个状态，直到满足某个条件（或者判断不能继续搜索时），再回溯到上一步，做出不同的选择。

典型的回溯代码框架如下：

```java
public class Solution {
    public List<List<Integer>> result = new ArrayList<>();
    
    public List<List<Integer>> solve() {
        List<Integer> current = new ArrayList<>();
        backtrack(current, 0);  // 调用回溯函数，0是起始位置
        return result;
    }
    
    private void backtrack(List<Integer> current, int start) {
        // 判断是否满足题目的条件
        if (满足某条件) {
            // 存储当前解
            result.add(new ArrayList<>(current));
            return;
        }
        
        // 选择当前状态的一个元素
        for (int i = start; i < 数组长度; i++) {
            current.add(某个元素);
            
            // 递归进入下一步
            backtrack(current, i + 1);  // 根据问题的需要，i+1或其他方式
            
            // 回溯：撤销当前选择
            current.remove(current.size() - 1);
        }
    }
}
```

### 回溯算法的步骤详解：
1. **递归函数的设计**：
    - 递归函数一般接收当前状态（如当前选择的数字、当前索引等）作为输入。
    - 每一次递归调用时，选择一个新的元素，进入下一个状态。
    - 当满足某个条件（例如，路径达到目标状态、树的叶子节点等），就将当前路径保存下来。
2. **回溯的递归调用**：
    - 在进入下一个递归调用时，如果满足当前条件，就继续递归，反之则回到上一步。
    - 每次递归调用之前，要做出选择；回溯时，需要撤销之前做出的选择，恢复状态。
3. **剪枝操作**：
    - 剪枝是回溯法中的一种优化策略，用来减少搜索空间。
    - 在每次递归时，如果发现某个选择不满足条件（例如，当前路径的和超过了目标值），就可以提前返回，避免进一步的无效递归。

### 回溯的时间复杂度：
回溯算法的时间复杂度通常较高，因为它遍历所有可能的解空间。假设解空间有 `n` 个元素，时间复杂度往往为 `O(b^d)`，其中 `b` 是每个节点的分支因子，`d` 是递归的深度。

![1735306262181-46a37c5c-82dc-42de-9834-5fcd5c909f3c.png](./img/KbZIYFwVquqrtSls/1735306262181-46a37c5c-82dc-42de-9834-5fcd5c909f3c-673295.png)



> 更新: 2024-12-27 21:35:32  
> 原文: <https://www.yuque.com/neumx/ko4psh/soh98fl7d81gcsak>