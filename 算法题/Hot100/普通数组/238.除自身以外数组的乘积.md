# 238. 除自身以外数组的乘积

### 解题思路（<font style="color:#DF2A3F;">构建前缀乘积和后缀乘积，然后相乘就是左边元素和右边元素的乘积</font>）
#### 核心思路
+ **乘积的前缀与后缀数组：**
    - 为了计算每个位置 `i` 的乘积，考虑数组元素左边的所有元素和右边的所有元素的乘积。
    - **前缀乘积：**`prefix[i]` 代表从 `0` 到 `i-1` 所有元素的乘积。
    - **后缀乘积：**`suffix[i]` 代表从 `i+1` 到最后一个元素的乘积。

然后对于每个 `i`，`answer[i]` 就是 `prefix[i]` 乘以 `suffix[i]`。

#### 具体步骤
1. 创建一个新的数组 `answer`，用于存储结果。
2. **构建前缀乘积：** 从左到右遍历，构建每个位置的前缀乘积。`prefix[i] = prefix[i-1] * nums[i-1]`。
3. **构建后缀乘积：** 从右到左遍历，构建每个位置的后缀乘积。`suffix[i] = suffix[i+1] * nums[i+1]`。
4. **计算结果：** 最终的 `answer[i]` 由 `answer[i] = prefix[i] * suffix[i]` 组成。

通过这样的方法，我们就可以在 O(n) 时间复杂度内完成任务。

#### 优化：
我们可以进一步优化空间复杂度，避免使用额外的 `prefix` 和 `suffix` 数组。只用一个数组 `answer` 来存储前缀乘积，并且通过从右到左的遍历来更新后缀乘积，这样空间复杂度降低为 O(1)。

---

```java
class Solution {
    public int[] productExceptSelf(int[] nums) {
        int n = nums.length;
        int[] answer = new int[n];
        
        // 步骤 1：构建前缀乘积数组
        answer[0] = 1;  // 前缀乘积数组初始化，左边没有元素，所以是1
        for (int i = 1; i < n; i++) {
            answer[i] = answer[i - 1] * nums[i - 1];
        }
        
        // 步骤 2：构建后缀乘积并同时更新 answer
        int suffix = 1;  // 后缀乘积初始化，右边没有元素，所以是1
        for (int i = n - 1; i >= 0; i--) {
            answer[i] = answer[i] * suffix;
            suffix *= nums[i];  // 更新后缀乘积
        }
        
        return answer;
    }
}

```

### 代码解析
1. **初始化前缀乘积：**
    - 在 `answer[0]` 位置初始化为 `1`，因为在 `0` 索引左边没有任何元素，所以前缀乘积是 `1`。
    - 接着，我们遍历数组 `nums`，更新 `answer` 数组，使得 `answer[i]` 存储了 `nums[0]` 到 `nums[i-1]` 的乘积。
2. **计算后缀乘积并更新结果：**
    - 我们从数组的末尾开始，初始化 `suffix` 为 `1`，表示右边没有任何元素时的乘积。
    - 从右到左遍历每个元素，通过 `answer[i] = answer[i] * suffix` 更新结果数组 `answer`。每一次都乘上右边的乘积。
    - 然后更新 `suffix` 为 `suffix * nums[i]`，以便下一个位置使用正确的后缀乘积。
3. **最终结果：**
    - `answer[i]` 存储了不包含 `nums[i]` 元素的所有元素的乘积。

### 时间复杂度和空间复杂度
+ **时间复杂度：**`O(n)`，其中 `n` 是数组 `nums` 的长度。我们只进行了两次遍历数组，每次遍历是 O(n) 时间复杂度。
+ **空间复杂度：**`O(1)`（不包括输入和输出）。我们只使用了常数级别的额外空间来存储前缀乘积和后缀乘积。返回的结果 `answer` 是存储在输入数组之外的，因此额外空间开销是常数级别。







> 更新: 2025-02-18 22:27:40  
> 原文: <https://www.yuque.com/neumx/ko4psh/yk5g3nf77883shkr>