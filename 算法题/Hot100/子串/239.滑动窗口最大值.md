# 239. 滑动窗口最大值

### 思路（<font style="color:#DF2A3F;"> 采用单调队列（双端队列）+滑动窗口 ，确保队列头部始终是当前窗口的最大值</font>）
我们可以采用 **双端队列**（Deque）来实现一个高效的滑动窗口最大值算法。

#### 核心思想：
+ 我们使用一个 **单调递减的队列**，这个队列保存的是数组的索引。队列的性质是：队列中存储的元素对应的值是单调递减的，也就是队列头部的元素对应的值最大。
+ 每次窗口右移时，我们将新的元素添加到队列中，同时确保队列保持单调递减。
+ 队列中只保留窗口中的元素的索引，一旦窗口左端的元素超出了当前窗口范围，它就会被移除。

### 详细步骤：
1. **初始化**：使用一个双端队列 `deque` 来存储元素的索引。初始化时，我们不处理任何元素。
2. **滑动窗口**：对于每个新的元素：
    - 从队列中移除所有比当前元素小的索引，因为它们不可能成为未来窗口的最大值。
    - 将当前元素的索引添加到队列的尾部。
    - 如果队列的头部元素已经超出了窗口的左端范围，我们将其移除。
3. **输出结果**：每次滑动完窗口时，队列头部的索引对应的元素即为当前窗口的最大值。

#### 代码
```java
class Solution {
    public int[] maxSlidingWindow(int[] nums, int k) {
        // 初始化结果数组，长度为窗口数量
        int[] res = new int[nums.length - k + 1];
        // 初始化结果数组的索引
        int index = 0;
        // 使用双端队列来维护窗口中的元素索引，确保队列中的元素值是单调递减的
        Deque<Integer> deque = new LinkedList<>();

        // 遍历数组中的每个元素
        for (int i = 0; i < nums.length; i++) {
            // 维持队列的单调递减性，如果当前元素大于队列尾部的元素，则弹出尾部元素
            while (!deque.isEmpty() && nums[i] > nums[deque.peekLast()]) {
                deque.pollLast();
            }
            // 将当前元素的索引添加到队列尾部
            deque.offer(i);

            // 检查队首元素是否还在窗口范围内，不在则弹出
            if (i - deque.peekFirst() >= k) {
                deque.pollFirst();
            }

            // 当窗口形成时（即i >= k - 1），队首元素即为当前窗口的最大值
            // 窗口已满，记录最大值
            if (i >= k - 1) {
                // 将当前窗口的最大值添加到结果数组
                res[index++] = nums[deque.peekFirst()];
            }
        }

        // 返回结果数组
        return res;
    }
}
```

### 解释
1. **队列操作**：
    - `deque.peekFirst()`：获取队列中的第一个元素，即当前窗口的最大值索引。
    - `deque.pollFirst()`：移除队列中的第一个元素，表示滑动窗口的左边界向右移动。
    - `deque.offerLast(i)`：将当前元素的索引添加到队列末尾。
2. **队列的维护**：
    - 每次添加一个新元素时，首先从队列尾部移除所有比当前元素小的元素，因为这些元素不可能再成为未来窗口的最大值。
    - 其次，如果队列头部的元素已经不在当前窗口内，我们就把它移除。
3. **输出最大值**：
    - 当窗口大小达到 `k` 后，每次将队列头部的元素对应的值加入到结果中。

### 时间复杂度
+ 时间复杂度：`O(n)`。每个元素只会被加入队列一次，也只会被移除队列一次，因此总的操作次数为 `2n`，即时间复杂度为 `O(n)`。
+ 空间复杂度：`O(k)`。队列中最多存储 `k` 个元素，因此空间复杂度是 `O(k)`。



> 更新: 2025-03-24 14:40:46  
> 原文: <https://www.yuque.com/neumx/ko4psh/yzqckdh8rg6ya57r>